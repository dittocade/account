---
import { actions } from "astro:actions";
import Layout from "@layouts/Layout.astro";
import Form from "@fancade-club/comps/forms/Form.astro";
import Input from "@fancade-club/comps/forms/Input.astro";
import Button from "@fancade-club/comps/forms/Button.astro";

if (Astro.locals.user) return Astro.redirect("/account");
---

<Layout title="Sign Up">
  <Form method="POST" action={"/" + actions.signup}>
    <Input required name="name" label="Name" />
    <Input required name="slug" label="Handle" />
    <Input required type="password" name="password" label="Password" />
    <Button>Sign up</Button>
  </Form>
  <p>Already a member? <a href="/login">Log in</a>!</p>
</Layout>

<script>
  import { slug } from "@lib/schema";

  const nameInput = document.getElementById("name-input") as HTMLInputElement;
  const slugInput = document.getElementById("slug-input") as HTMLInputElement;

  function setSlug(this: HTMLInputElement) {
    const { success, data } = slug().safeParse(this.value);
    if (success) slugInput.value = data;
  }

  nameInput.addEventListener("input", setSlug);
  slugInput.addEventListener("input", setSlug);
</script>
